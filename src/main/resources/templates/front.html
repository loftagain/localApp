<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>360&deg; Image</title>
    <meta name="description" content="360&deg; Image - A-Frame">
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
</head>
<body>
<a-scene>
    <a-sky src="/static/images/wash-dresden.jpg" rotation="0 -130 0"></a-sky>

    <a-text font="kelsonsans" value="Hiiiii" width="6" position="-2.5 -0.25 -1.5" rotation="0 15 0"></a-text>

    <!-- 6 3D Model components arranged in a circle with slight floating effect, lowered position, and larger scale -->
    <a-entity id="myButton2" gltf-model="url(/static/soulsucker/scene.gltf)" scale="1.5 1.5 1.5" position="5 -0.5 0" rotation="0 -90 0" class="clickable">
        <a-animation attribute="position" to="5 0.05 0" direction="alternate" dur="2000" repeat="indefinite"></a-animation>
    </a-entity>
    <a-entity id="myButton3" gltf-model="url(/static/soulsucker/scene.gltf)" scale="1.5 1.5 1.5" position="2.5 -0.5 4.33" rotation="0 -150 0" class="clickable">
        <a-animation attribute="position" to="2.5 0.05 4.33" direction="alternate" dur="2000" repeat="indefinite"></a-animation>
    </a-entity>
    <a-entity id="myButton4" gltf-model="url(/static/soulsucker/scene.gltf)" scale="1.5 1.5 1.5" position="-2.5 -0.5 4.33" rotation="0 150 0" class="clickable">
        <a-animation attribute="position" to="-2.5 0.05 4.33" direction="alternate" dur="2000" repeat="indefinite"></a-animation>
    </a-entity>
    <a-entity id="myButton5" gltf-model="url(/static/soulsucker/scene.gltf)" scale="1.5 1.5 1.5" position="-5 -0.5 0" rotation="0 90 0" class="clickable">
        <a-animation attribute="position" to="-5 0.05 0" direction="alternate" dur="2000" repeat="indefinite"></a-animation>
    </a-entity>
    <a-entity id="myButton6" gltf-model="url(/static/soulsucker/scene.gltf)" scale="1.5 1.5 1.5" position="-2.5 -0.5 -4.33" rotation="0 30 0" class="clickable">
        <a-animation attribute="position" to="-2.5 0.05 -4.33" direction="alternate" dur="2000" repeat="indefinite"></a-animation>
    </a-entity>
    <a-entity id="myButton7" gltf-model="url(/static/soulsucker/scene.gltf)" scale="1.5 1.5 1.5" position="2.5 -0.5 -4.33" rotation="0 -30 0" class="clickable">
        <a-animation attribute="position" to="2.5 0.05 -4.33" direction="alternate" dur="2000" repeat="indefinite"></a-animation>
    </a-entity>

    <!-- Simple VR button -->
    <a-box id="myButton" position="0 1.6 -3" rotation="0 45 0" width="1" height="1" depth="0.2" color="#4CC3D9" class="clickable">
        <a-text value="Click Me" align="center" position="0 0 0.1" color="#FFF"></a-text>
    </a-box>
    <!-- Text message initially hidden -->
    <a-text id="message" value="Click the model!" position="0 2 -3" color="blue" visible="false"></a-text>
    <!-- Add a camera and cursor for VR interaction -->
    <a-entity id="cameraRig" camera position="0 1.6 0" wasd-controls look-controls="reverse-mouse-drag: true">
        <a-entity cursor="fuse: false; rayOrigin: mouse" raycaster="objects: .clickable" position="0 0 -1" geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03" material="color: #FFF; shader: flat;"></a-entity>
    </a-entity>
</a-scene>
<script>
    AFRAME.registerComponent('toggle-visibility', {
        init: function () {
            // Reference to the text element
            const message = document.querySelector('#message');
            const moveDistance = 1.0; // Distance to move towards the user

            // Add event listener to the element this component is attached to
            this.el.addEventListener('click', function (event) {
                // Toggle the visibility of the text element
                const isVisible = message.getAttribute('visible');
                message.setAttribute('visible', !isVisible);

                // Identify the clicked model
                const clickedModel = event.currentTarget;
                let currentPosition = clickedModel.getAttribute('position');

                // Get the user's current position (camera position)
                const userPosition = document.querySelector('#cameraRig').getAttribute('position');

                // Calculate the direction vector towards the user's position
                let direction = {
                    x: userPosition.x - currentPosition.x,
                    y: 0, // Keep y the same
                    z: userPosition.z - currentPosition.z
                };

                // Normalize the direction vector
                let length = Math.sqrt(direction.x * direction.x + direction.z * direction.z);
                direction.x /= length;
                direction.z /= length;

                // Calculate the new position
                let newPosition = (clickedModel.isAtCenter) ?
                    clickedModel.originalPosition :
                    {
                        x: currentPosition.x + direction.x * moveDistance,
                        y: currentPosition.y,
                        z: currentPosition.z + direction.z * moveDistance
                    };

                // Animate the model to the new position
                clickedModel.setAttribute('animation__move', `property: position; to: ${newPosition.x} ${newPosition.y} ${newPosition.z}; dur: 1000; easing: easeInOutQuad;`);

                // Toggle the isAtCenter flag
                clickedModel.isAtCenter = !clickedModel.isAtCenter;

                // Store the original position if not already stored
                if (!clickedModel.originalPosition) {
                    clickedModel.originalPosition = { x: currentPosition.x, y: currentPosition.y, z: currentPosition.z };
                }
            });
        }
    });

    // Attach the component to each clickable model individually
    document.querySelectorAll('.clickable').forEach(el => {
        el.setAttribute('toggle-visibility', '');
        el.isAtCenter = false; // Initialize the isAtCenter flag
    });
</script>
</body>
</html>
